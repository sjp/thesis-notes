<!DOCTYPE html>
<html>
<head>
    <title>SVG Smoother Demo</title>
</head>
<body>
    <h1>Interactive smoother example</h1>
    <div id="wsdi_status"> Connection not initialized </div>
    <hr>
    <input id="span-slider" type="range" min="0.05" max="1" step="0.01" value="0.75" />
    <input id="span-text" type="text" value="0.75" readonly />
    <hr>
<svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     width="672px"
     height="672.121191135734px"
     version="1.0"><g transform="translate(0, 672.121191135734)  scale(1, -1)">
  <g id="gridSVG"  fill="none" stroke="rgb(0,0,0)" stroke-dasharray="none" stroke-width="1.33488765774084px" font-size="16.04px" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" opacity="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-opacity="1" fill-opacity="0">
    <g id="GRID.gTree.134"  >
      <g id="layout.1"  >
      <defs>
        <clipPath id="layout-1-1.1.clipPath">
          <rect x="3.73034936274053e-14" y="-1.49240884347476e-13" width="672" height="672.121191135734" style="fill: none; stroke: none;" />
        </clipPath>
      </defs>
      <g id="layout-1-1.1"  clip-path="url(#layout-1-1.1.clipPath)" >
        <g id="layout-1-1"  >
        <rect id="layout-1-1.1" x="0" y="0" width="672" height="672.12"  stroke-width="1.89196675781098px" stroke="none" fill="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="0" fill-opacity="1" />
        </g>
      </g>
    </g>
    <g id="layout.2"  >
      <g id="axis-l-3-3.1"  >
        <g id="axis-l-3-3"  >
          <g id="GRID.VP.16.1"  >
            <g id="axis.frame.122"  >
              <g id="GRID.VP.17.1"  >
                <g id="GRID.cellGrob.123"  >
                  <g id="axis.text.y.text.117"  >
                  <g id="axis.text.y.text.117.1"  stroke-width=".1" transform="translate(52.25, 186.37) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="end" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="4.5" x="0">0</tspan></text>
</g>
</g>
                  <g id="axis.text.y.text.117.2"  stroke-width=".1" transform="translate(52.25, 352.58) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="end" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="4.5" x="0">50</tspan></text>
</g>
</g>
                  <g id="axis.text.y.text.117.3"  stroke-width=".1" transform="translate(52.25, 518.79) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="end" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="4.5" x="0">100</tspan></text>
</g>
</g>
                  </g>
                </g>
              </g>
              <g id="GRID.VP.18.1"  >
                <g id="GRID.cellGrob.124"  >
                  <g id="axis.ticks.segments.120"  >
                  <polyline id="axis.ticks.segments.120.1" points="56.03,186.37 61.71,186.37"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                  <polyline id="axis.ticks.segments.120.2" points="56.03,352.58 61.71,352.58"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                  <polyline id="axis.ticks.segments.120.3" points="56.03,518.79 61.71,518.79"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                  </g>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
    <g id="layout.3"  >
      <g id="spacer-4-3.1"  >
      </g>
    </g>
    <g id="layout.4"  >
    <defs>
      <clipPath id="panel-3-4.1.clipPath">
        <rect x="61.7067885573571" y="49.7084116529249" width="591.048420807723" height="603.16798884789" style="fill: none; stroke: none;" />
      </clipPath>
    </defs>
    <g id="panel-3-4.1"  clip-path="url(#panel-3-4.1.clipPath)" >
      <g id="panel-3-4"  >
        <g id="grill.gTree.104"  >
          <g id="panel.background.rect.95"  >
          <rect id="panel.background.rect.95.1" x="61.71" y="49.71" width="591.05" height="603.17"  stroke-width="1.89196675781098px" stroke="none" fill="rgb(229,229,229)" stroke-dasharray="none" stroke-opacity="0" fill-opacity="1" />
          </g>
          <g id="panel.grid.minor.y.polyline.97"  >
          <polyline id="panel.grid.minor.y.polyline.97.1" points="61.71,103.26 652.76,103.26"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.y.polyline.97.2" points="61.71,269.47 652.76,269.47"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.y.polyline.97.3" points="61.71,435.68 652.76,435.68"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.y.polyline.97.4" points="61.71,601.89 652.76,601.89"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          </g>
          <g id="panel.grid.minor.x.polyline.99"  >
          <polyline id="panel.grid.minor.x.polyline.99.1" points="155.74,49.71 155.74,652.88"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.x.polyline.99.2" points="290.07,49.71 290.07,652.88"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.x.polyline.99.3" points="424.4,49.71 424.4,652.88"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.minor.x.polyline.99.4" points="558.72,49.71 558.72,652.88"  stroke-width="0.94598337890549px" stroke="rgb(242,242,242)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          </g>
          <g id="panel.grid.major.y.polyline.101"  >
          <polyline id="panel.grid.major.y.polyline.101.1" points="61.71,186.37 652.76,186.37"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.y.polyline.101.2" points="61.71,352.58 652.76,352.58"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.y.polyline.101.3" points="61.71,518.79 652.76,518.79"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          </g>
          <g id="panel.grid.major.x.polyline.103"  >
          <polyline id="panel.grid.major.x.polyline.103.1" points="88.57,49.71 88.57,652.88"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.x.polyline.103.2" points="222.9,49.71 222.9,652.88"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.x.polyline.103.3" points="357.23,49.71 357.23,652.88"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.x.polyline.103.4" points="491.56,49.71 491.56,652.88"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          <polyline id="panel.grid.major.x.polyline.103.5" points="625.89,49.71 625.89,652.88"  stroke-width="1.89196675781098px" stroke="rgb(255,255,255)" stroke-dasharray="none" stroke-opacity="1" fill="none" />
          </g>
        </g>
        <g id="GRID.polyline.91"  >
        <polyline id="GRID.polyline.91.1" points="88.57,534.6 94,577.93 99.43,544.09 104.85,480.4 110.28,499.75 115.71,350.05 121.14,413.68 126.56,440.25 131.99,398.04 137.42,307.29 142.85,370.46 148.27,293.01 153.7,367.07 159.13,377.55 164.56,385.79 169.98,283.22 175.41,367.91 180.84,324.71 186.27,169.21 191.69,279.37 197.12,331.51 202.55,281.32 207.98,243.11 213.4,298.67 218.83,287.59 224.26,175.34 229.69,262.04 235.11,301.46 240.54,300.28 245.97,298.39 251.4,162.09 256.82,206.99 262.25,129.73 267.68,121.91 273.11,214.37 278.53,220.88 283.96,213.82 289.39,163.74 294.82,208 300.24,121.74 305.67,181.05 311.1,159.8 316.53,230.14 321.95,153.86 327.38,209.85 332.81,177.08 338.23,207.73 343.66,244.63 349.09,217.8 354.52,155.75 359.94,221.21 365.37,180.1 370.8,252.51 376.23,166.17 381.65,154.13 387.08,165.92 392.51,273.17 397.94,77.13 403.36,112.74 408.79,249.01 414.22,224.95 419.65,201.8 425.07,195 430.5,189.66 435.93,229.6 441.36,182.01 446.78,124.97 452.21,237.92 457.64,231.64 463.07,161.46 468.49,263.29 473.92,298.74 479.35,228.6 484.78,271.65 490.2,280.38 495.63,233.24 501.06,325.73 506.49,363.29 511.91,288.38 517.34,340.5 522.77,288.76 528.2,312.62 533.62,296.94 539.05,329.56 544.48,371.52 549.91,268.97 555.33,384.41 560.76,351.21 566.19,339.86 571.61,364.96 577.04,456.68 582.47,356.93 587.9,470.62 593.32,464.75 598.75,516.81 604.18,490.05 609.61,554.67 615.03,625.46 620.46,518.35 625.89,586.13"  stroke="rgb(0,0,0)" stroke-width="1.89px" stroke-dasharray="none" stroke-linecap="butt" stroke-linejoin="round" stroke-miterlimit="1" stroke-opacity="1" fill="none" />
        </g>
      </g>
    </g>
  </g>
  <g id="layout.5"  >
    <g id="axis-b-4-4.1"  >
      <g id="axis-b-4-4"  >
        <g id="GRID.VP.13.1"  >
          <g id="axis.frame.112"  >
            <g id="GRID.VP.14.1"  >
              <g id="GRID.cellGrob.113"  >
                <g id="axis.text.x.text.107"  >
                <g id="axis.text.x.text.107.1"  stroke-width=".1" transform="translate(88.57, 40.25) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="9" x="0">-10</tspan></text>
</g>
</g>
                <g id="axis.text.x.text.107.2"  stroke-width=".1" transform="translate(222.9, 40.25) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="9" x="0">-5</tspan></text>
</g>
</g>
                <g id="axis.text.x.text.107.3"  stroke-width=".1" transform="translate(357.23, 40.25) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="9" x="0">0</tspan></text>
</g>
</g>
                <g id="axis.text.x.text.107.4"  stroke-width=".1" transform="translate(491.56, 40.25) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="9" x="0">5</tspan></text>
</g>
</g>
                <g id="axis.text.x.text.107.5"  stroke-width=".1" transform="translate(625.89, 40.25) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="12.81px" stroke="rgb(127,127,127)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(127,127,127)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="9" x="0">10</tspan></text>
</g>
</g>
                </g>
              </g>
            </g>
            <g id="GRID.VP.15.1"  >
              <g id="GRID.cellGrob.114"  >
                <g id="axis.ticks.segments.110"  >
                <polyline id="axis.ticks.segments.110.1" points="88.57,44.03 88.57,49.71"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                <polyline id="axis.ticks.segments.110.2" points="222.9,44.03 222.9,49.71"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                <polyline id="axis.ticks.segments.110.3" points="357.23,44.03 357.23,49.71"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                <polyline id="axis.ticks.segments.110.4" points="491.56,44.03 491.56,49.71"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                <polyline id="axis.ticks.segments.110.5" points="625.89,44.03 625.89,49.71"  stroke="rgb(127,127,127)" stroke-dasharray="none" stroke-width="1.89196675781098px" stroke-opacity="1" fill="none" />
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
  </g>
  <g id="layout.6"  >
    <g id="xlab-5-4.1"  >
      <g id="xlab-5-4"  >
      <g id="xlab-5-4.1"  stroke-width=".1" transform="translate(357.23, 20.43) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="16.02px" stroke="rgb(0,0,0)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(0,0,0)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="6" x="0">xs</tspan></text>
</g>
</g>
      </g>
    </g>
  </g>
  <g id="layout.7"  >
    <g id="ylab-3-2.1"  >
      <g id="ylab-3-2"  >
      <g id="ylab-3-2.1"  stroke-width=".1" transform="translate(20.43, 351.29) ">
<g transform="scale(1, -1)">
<text x="0" y="0" transform="rotate(-90)" text-anchor="middle" font-size="16.02px" stroke="rgb(0,0,0)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(0,0,0)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="6" x="0">ys</tspan></text>
</g>
</g>
      </g>
    </g>
  </g>
  <g id="layout.8"  >
    <g id="title-2-4.1"  >
      <g id="title-2-4"  >
      <g id="title-2-4.1"  stroke-width=".1" transform="translate(357.23, 652.88) ">
<g transform="scale(1, -1)">
<text x="0" y="0" text-anchor="middle" font-size="19.22px" stroke="rgb(0,0,0)" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" stroke-opacity="1" fill="rgb(0,0,0)" fill-opacity="1" font-weight="normal" font-style="normal" >
<tspan dy="7" x="0"> </tspan></text>
</g>
</g>
      </g>
    </g>
  </g>
</g>
</g>
</g>
</svg>
    <hr>
    <div id="istat"></div>
    <br>
    <div id="output"></div>
    <script type="text/javascript" src="http://d3js.org/d3.v2.min.js""></script>
    <script type="text/javascript">
    // The following is just a convenience function for use within a JS environment
    String.prototype.startsWith = function(str) {
        return (this.indexOf(str) === 0);
    }
    
    var socket;
    try {
        socket = new WebSocket("ws://" + window.location.host, "svg-smoother-ex");
      
        socket.onopen = function() {
            document.getElementById("wsdi_status").textContent = " websocket connection opened ";
            document.getElementById("wsdi_status").style.backgroundColor = "#40ff40";
        } 
      
        socket.onmessage = function got_packet(msg) {
            if (msg.data.startsWith("Connection")) {
                document.getElementById("istat").textContent = msg.data;
            } else {
                var el = document.getElementById("smoothline");
                var g = document.getElementById("GRID.polyline.91");
                // Because the response is not XML, just plain text we need to parse the result
                var newdoc = new DOMParser().parseFromString(msg.data, "image/svg+xml");
                var newnode = document.importNode(newdoc.documentElement.firstChild, true);
                // At the start we don't have a smoother, only remove if available
                if (el) {
                    var newpoints = newnode.getAttribute("points");
                    d3.select('#smoothline')
                        .transition()
                        .duration(1000)
                        .attr("points", newpoints);
                } else {
                    var textn = g.firstChild;
                    g.removeChild(textn);
                    var original = g.firstChild;
                    var smoothline = original.cloneNode(true);
                    smoothline.setAttribute("id", "smoothline");
                    smoothline.setAttribute("stroke", "red");
                    smoothline.setAttribute("points", newnode.getAttribute("points"));
                    g.appendChild(smoothline);
                }
            }
        } 
      
        socket.onclose = function(){
            document.getElementById("wsdi_status").textContent = " websocket connection CLOSED ";
            document.getElementById("wsdi_status").style.backgroundColor = "#ff4040";
        }
    } catch(ex) {
        document.getElementById("output").textContent = "Error: " + ex;
    }

    var sliderText = document.getElementById("span-text");
    var slider = document.getElementById("span-slider");

    // Create event handler function
    var updateSmooth = function() {
        sliderText.value = slider.value;
        socket.send(slider.value);
    };
    // Assign to the slider
    slider.addEventListener("mouseup", updateSmooth);

    </script>
</body>
</html>
